# 黄金板块交易策略

基于国际金价涨跌的黄金板块股票交易策略，通过分析国际金价走势来指导黄金板块股票的买卖决策。

## 策略说明
```
说明：
我发现国际金价对A股的黄金板块影响较大，我的量化策略如下：
第一步：每天早上8点获取国际金价，假设金价是1000。
第二步：获取国际金价相较于前一天的涨跌幅度，假设上涨1%。
第三步：买入规则：如果第二步获取的金价是上涨，则在早上9:30买入一支黄金板块的股票，买入 10000 * 1%。（说明：
这里的10000是每次买入的设置的基础价格，你需要做成全局变量；这里是1%是金价上涨的幅度。）。如果第
二步获取的金价是下跌，则不买入。
第四步：卖出规则：如果前一天有买入，则第二天就需要卖出。卖出规则定义：假设当前已盈利5%，那么当盈利回调到4%时卖出。（说明：卖出规则需要定义为一个函数）
第五步：设置止损价格为本金的10%。
额外注意：
1、所有魔法值都需要做成全局参数，并且加上对应注释。
2、具体选择哪一只黄金板块的股票，目前先使用 湖南黄金 股票。

```

## 📊 策略逻辑

### 核心思路
- **数据驱动**：根据国际金价的涨跌幅度决定买入金额
- **风险控制**：设置止损和盈利回调机制
- **自动化执行**：支持定时执行和手动操作

### 交易规则

#### 买入规则
1. **触发条件**：国际金价上涨时买入
2. **买入金额**：基础投资金额 × 金价涨跌幅
3. **目标股票**：湖南黄金 (002155)

#### 卖出规则
1. **止损**：亏损达到10%时强制卖出
2. **盈利回调**：当盈利达到5%后，回调到4%时卖出
3. **持仓管理**：前一天买入，第二天考虑卖出

## 🛠️ 文件结构

```
gold/
├── advanced_interactive_system_professional.py # 专业K线图系统
├── web_server.py                 # Web服务器
├── start_system.py               # 启动脚本
├── config.py                     # 配置文件
├── requirements.txt              # 依赖包
└── README.md                    # 说明文档
```

## 🚀 使用方法

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行系统

#### 方法一：Web界面模式（推荐）
```bash
# 启动Web界面
python start_system.py

# 或直接启动Web服务器
python web_server.py
```
访问 http://localhost:5000 使用Web界面

#### 方法二：控制台模式
```bash
# 传统控制台界面
python start_system.py --mode console

# 或直接运行专业系统
python advanced_interactive_system_professional.py
```

#### 方法三：安装依赖（首次使用）
```bash
# 自动安装所有依赖包
python install_dependencies.py

# 或手动安装
pip install -r requirements.txt
```

#### 方法四：测试系统
```bash
# 测试系统功能
python test_web.py
```

### 🌐 Web界面功能
全新的Web界面提供更友好的用户体验：

1. **可视化时间范围选择**
   - 支持1个月到24个月预设选项
   - 自定义开始和结束日期
   - 智能日期验证

2. **多股票支持**
   - 湖南黄金、山东黄金、银泰黄金等
   - 一键切换不同股票分析
   - 实时股票数据获取

3. **交互式K线图**
   - 使用Plotly绘制交互式K线图
   - 支持鼠标悬停显示详细数据
   - 包含移动平均线、成交量分析
   - 支持缩放、平移、下载

4. **策略状态面板**
   - 实时显示当前股价、国际金价
   - 显示金价涨跌幅、持仓状态
   - 显示策略参数和交易统计
   - 响应式设计，支持移动设备

### 💻 控制台功能
传统控制台模式仍然可用：

1. **交互式K线图**
   - 使用Plotly绘制交互式K线图
   - 支持鼠标悬停显示详细数据
   - 包含移动平均线、成交量分析
   - 输出HTML文件，可在浏览器中查看

2. **策略状态面板**
   - 实时显示当前股价、国际金价
   - 显示金价涨跌幅、持仓状态
   - 显示策略参数和交易统计
   - 所有信息都在图表下方的表格中

3. **无需控制台操作**
   - 所有信息都显示在图表界面中
   - 不需要在控制台输入选项
   - 策略状态实时更新

### 交互功能说明

#### 鼠标悬停功能
- 鼠标悬停在K线上显示OHLC数据、涨跌幅、成交量等
- 实时显示移动平均线数据

#### 图表操作
- **缩放**: 鼠标滚轮或工具栏缩放
- **平移**: 拖拽图表移动视角
- **下载**: 支持PNG、SVG、PDF等格式
- **全屏**: 支持全屏显示模式

#### 技术指标
- **移动平均线**: MA5、MA20
- **成交量分析**: 红绿柱状图显示
- **价格趋势**: 涨跌颜色区分

### 安装依赖
```bash
pip install -r requirements.txt
```

### 注意事项
1. 首次运行需要安装plotly相关依赖
2. HTML文件需要在浏览器中打开
3. 建议使用Chrome或Firefox浏览器查看HTML图表

## 🔧 K线图修复说明

### 修复的问题
1. **K线图显示问题**：修复了K线图不显示的问题，现在可以正确显示蜡烛图
2. **移动平均线问题**：修复了MA5和MA20移动平均线显示异常的问题
3. **成交量显示问题**：修复了成交量显示为填充区域的问题，现在使用正确的柱状图
4. **数据真实性问题**：改进了模拟数据生成算法，使数据更加真实

### 修复内容
- 增强了K线图的颜色对比度和可见性
- 修复了移动平均线的计算和显示
- 改进了成交量柱状图的显示方式
- 优化了模拟数据的生成算法，使价格波动更加真实

### 测试方法
```bash
# 快速测试K线图修复效果
python quick_test.py

# 运行系统
python start_system.py

# Web模式
python start_system.py --mode web

# 控制台模式
python start_system.py --mode console

# 专业K线图系统（推荐）
python advanced_interactive_system_professional.py
```

## 🎯 专业K线图库

### 推荐使用专业版本
```bash
# 专业K线图系统（效果最佳）
python advanced_interactive_system_professional.py

# 专业K线图库测试
python professional_kline_system.py
```

### 专业K线图特点
- ✅ **专业的K线图样式**：使用专业的颜色和线条
- ✅ **清晰的移动平均线**：MA5和MA20正确显示
- ✅ **准确的成交量**：柱状图显示，颜色区分涨跌
- ✅ **真实的价格波动**：模拟数据更真实
- ✅ **专业的布局**：字体、网格、间距优化