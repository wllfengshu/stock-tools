# 黄金板块交易策略

基于国际金价涨跌的黄金板块股票交易策略，通过分析国际金价走势来指导黄金板块股票的买卖决策。

## 策略说明
```
说明：
我发现国际金价对A股的黄金板块影响较大，我的量化策略如下：
第一步：每天早上8点获取国际金价，假设金价是1000。
第二步：获取国际金价相较于前一天的涨跌幅度，假设上涨1%。
第三步：买入规则：如果第二步获取的金价是上涨，则在早上9:30买入一支黄金板块的股票，买入 10000 * 1%。（说明：
这里的10000是每次买入的设置的基础价格，你需要做成全局变量；这里是1%是金价上涨的幅度。）。如果第
二步获取的金价是下跌，则不买入。
第四步：卖出规则：如果前一天有买入，则第二天就需要卖出。卖出规则定义：假设当前已盈利5%，那么当盈利回调到4%时卖出。（说明：卖出规则需要定义为一个函数）
第五步：设置止损价格为本金的10%。
额外注意：
1、所有魔法值都需要做成全局参数，并且加上对应注释。
2、具体选择哪一只黄金板块的股票，目前先使用 湖南黄金 股票。

```

## 📊 策略逻辑

### 核心思路
- **数据驱动**：根据国际金价的涨跌幅度决定买入金额
- **风险控制**：设置止损和盈利回调机制
- **自动化执行**：支持定时执行和手动操作

### 交易规则

#### 买入规则
1. **触发条件**：国际金价上涨时买入
2. **买入金额**：基础投资金额 × 金价涨跌幅
3. **目标股票**：湖南黄金 (002155)

#### 卖出规则
1. **止损**：亏损达到10%时强制卖出
2. **盈利回调**：当盈利达到5%后，回调到4%时卖出
3. **持仓管理**：前一天买入，第二天考虑卖出

## 🛠️ 项目结构

```
├── data_provider.py # 专业K线图系统
├── web_server.py                 # Web服务器
├── start.py               # 启动脚本
├── requirements.txt              # 依赖包
├── similarity_analyzer              # K线相似度分析器
├── trading_strategy              # 交易策略
└── README.md                    # 说明文档

```

## 需求设计（概设）

### 基础信息模块
1. 触发时机：在web页面打开时，立即执行一次
2. 参数设置
   - 选择股票（下拉选择某一只股票）
   - 初始资金（例如初始资金1000元）
   - 分析时间范围（下拉选择，1个月、2个月、3个月、6个月、12个月、24个月）
3. 图表
   - 表格：当前股价、股价涨跌、国际金价、金价涨跌、总成本、总持股数、总资产、今日收益率、累计收益率、年化收益率
   - 图：当前股票的K线图、国际金价的K线图

### 相似度分析模块
1. 触发时机：在web页面中，点击“走势相似度分析”按钮
2. 参数设置
   - correlation: 价格变化相关性 (30%)
   - trend: 趋势方向一致性 (25%) 
   - volatility: 波动性相似度 (20%)
   - pattern: 价格模式匹配 (15%)
   - volume: 成交量关系 (10%)
3. 图表
   - 表格：价格相关性、趋势一致性、波动性相似度、模式匹配、成交量关系
   - 图：根据当前股票K线图和国际金价K线图拟合出来的趋势图（横坐标是每一天，纵坐标是每天的相似度）

### 交易策略执行模块
1. 触发时机：在web页面中，点击“执行策略”
2. 参数设置
   - base_investment: 每次投资的基准金额（每次买入金额 = 基础金额 × 金价涨幅）
   - stop_loss_rate: 止损率（当亏损到总成本的（1-止损率）时卖出）
   - profit_callback_rate: 盈利回调率（从最大盈利率回调到（最大盈利率-盈利回调率）时卖出）
   - max_profit_rate: 最大盈利率（当盈利超过最大盈利率时卖出）
   - min_gold_change: 最小金价涨幅阈值（0.2%，只有金价涨幅超过最小金价涨幅阈值时才买入）
   - min_buy_amount: 最小买入金额（每次买入金额不能小于最小买入金额）
   - transaction_cost_rate: 交易成本率（0.1%，每次买入和卖出时需要扣除交易成本）
   - max_hold_days: 最大持仓天数（超过最大持仓天数时卖出）
3. 图表
   - 表格：每天的交易记录
   - 图：收益率曲线


## 详细需求分析文档
```markdown
# 黄金板块量化交易系统需求分析文档

## 1. 项目概述

### 1.1 项目背景
基于国际金价涨跌的黄金板块股票交易策略系统，通过分析国际金价走势来指导黄金板块股票的买卖决策。系统集成了数据获取、相似度分析、策略执行和回测功能。

### 1.2 项目目标
- 实现基于国际金价的自动化交易策略
- 提供K线图相似度分析功能
- 支持历史回测和策略验证
- 提供直观的Web界面进行参数配置和结果展示

### 1.3 技术架构
- **前端**: HTML + JavaScript + Plotly.js
- **后端**: Python + Flask
- **数据源**: akshare开源框架API
- **部署环境**: Linux
- **并发支持**: 最多10个并发用户

## 2. 功能需求

### 2.1 基础信息模块

#### 2.1.1 功能描述
提供实时股票和金价数据展示，支持参数配置和时间范围选择。

#### 2.1.2 功能需求
- **触发时机**: Web页面打开时立即执行一次
- **数据刷新**: 定时自动刷新（建议5分钟间隔）
- **参数配置**:
  - 股票选择：下拉选择框，支持多只黄金板块股票
  - 初始资金：数值输入框，默认1000元
  - 分析时间范围：下拉选择（1个月、2个月、3个月、6个月、12个月、24个月）

#### 2.1.3 数据展示
**表格数据**:
- 当前股价
- 股价涨跌（金额和百分比）
- 国际金价
- 金价涨跌（金额和百分比）
- 总成本
- 总持股数
- 总资产
- 今日收益率
- 累计收益率
- 年化收益率

**图表展示**:
- 当前股票K线图（支持缩放和交互）
- 国际金价K线图（支持缩放和交互）

### 2.2 相似度分析模块

#### 2.2.1 功能描述
分析股票价格走势与国际金价走势的相似度，提供多维度分析结果。

#### 2.2.2 功能需求
- **触发时机**: 点击"走势相似度分析"按钮
- **分析维度**:
  - 价格变化相关性 (30%)
  - 趋势方向一致性 (25%)
  - 波动性相似度 (20%)
  - 价格模式匹配 (15%)
  - 成交量关系 (10%)

#### 2.2.3 数据展示
**表格数据**:
- 价格相关性得分
- 趋势一致性得分
- 波动性相似度得分
- 模式匹配得分
- 成交量关系得分
- 综合相似度得分

**图表展示**:
- 每日相似度趋势图（横坐标：日期，纵坐标：相似度分数）
- 多维度雷达图展示各维度得分

### 2.3 交易策略执行模块

#### 2.3.1 功能描述
执行基于国际金价的量化交易策略，支持实时执行和历史回测。

#### 2.3.2 功能需求
- **触发时机**: 
  - 点击"执行策略"按钮（实时执行）
  - 定时执行（每日8:00获取金价，9:30执行交易）
- **策略参数**:
  - base_investment: 每次投资基准金额（默认10000元）
  - stop_loss_rate: 止损率（默认10%）
  - profit_callback_rate: 盈利回调率（默认1%）
  - max_profit_rate: 最大盈利率（默认50%）
  - min_gold_change: 最小金价涨幅阈值（默认0.2%）
  - min_buy_amount: 最小买入金额（默认100元）
  - transaction_cost_rate: 交易成本率（默认0.1%）
  - max_hold_days: 最大持仓天数（默认30天）

#### 2.3.3 历史回测功能
- **时间范围选择**: 支持选择1-6个月的历史数据
- **回测参数**: 与实时执行参数保持一致
- **回测结果**: 生成详细的交易记录和收益分析

#### 2.3.4 数据展示
**交易记录表格**:
- 交易日期
- 交易类型（买入/卖出）
- 交易价格
- 交易数量
- 交易金额
- 累计收益
- 收益率

**图表展示**:
- 收益率曲线图
- 资金曲线图
- 持仓变化图

## 3. 非功能需求

### 3.1 性能需求
- **响应时间**: 页面加载时间 < 3秒
- **数据处理**: 支持最多12个月历史数据回测
- **并发用户**: 支持最多10个并发用户
- **数据更新**: 实时数据5分钟内更新

### 3.2 可靠性需求
- **数据准确性**: 确保数据源API调用的准确性
- **错误处理**: 网络异常时提供友好的错误提示
- **数据备份**: 重要参数和状态数据本地持久化

### 3.3 可用性需求
- **界面友好**: 直观的Web界面，支持响应式设计
- **操作简便**: 关键功能一键执行
- **参数配置**: 提供合理的默认值和参数说明

### 3.4 安全需求
- **数据安全**: 本地部署，无外部数据泄露风险
- **访问控制**: 单用户系统，无需认证
- **参数验证**: 输入参数范围验证和异常处理

## 4. 技术约束

### 4.1 开发环境
- **操作系统**: Linux
- **编程语言**: Python 3.7+ （使用python虚拟环境）
- **Web框架**: Flask
- **前端技术**: HTML5 + JavaScript + Plotly.js
- **数据源**: akshare开源框架

### 4.2 部署要求
- **服务器**: Linux环境
- **端口**: 默认5000端口
- **依赖管理**: requirements.txt
- **启动方式**: 支持脚本启动和手动启动

### 4.3 数据约束
- **数据源限制**: 依赖akshare API的可用性
- **历史数据**: 最多支持12个月历史回测
- **实时性**: 数据更新可能存在延迟

## 5. 接口需求

### 5.1 数据接口
- **股票数据**: 通过akshare获取A股黄金板块股票数据
- **金价数据**: 通过akshare获取国际金价数据
- **数据格式**: 支持JSON格式数据交换

### 5.2 Web接口
- **页面路由**: 
  - `/`: 主页面
  - `/api/basic_info`: 基础信息API
  - `/api/similarity_analysis`: 相似度分析API
  - `/api/strategy_execute`: 策略执行API
  - `/api/backtest`: 历史回测API

### 5.3 定时任务接口
- **数据更新**: web页面需要定时刷新数据，先设置10s自动刷新
- **策略执行**: 每日9:30执行交易策略，判断是否买入。每日14:30执行交易策略，判断是否卖出。
- **状态检查**: 定期检查系统运行状态

## 6. 验收标准

### 6.1 功能验收
- [ ] 基础信息模块能正确显示实时数据
- [ ] 相似度分析模块能生成准确的相似度分数
- [ ] 交易策略执行模块能正确执行买卖逻辑
- [ ] 历史回测功能能生成完整的交易记录
- [ ] 所有参数配置功能正常工作

### 6.2 性能验收
- [ ] 页面加载时间 < 3秒
- [ ] 12个月历史回测在5分钟内完成
- [ ] 支持10个并发用户访问
- [ ] 数据更新及时准确

### 6.3 界面验收
- [ ] 界面美观，操作直观
- [ ] 图表显示正确，支持交互
- [ ] 参数配置界面友好
- [ ] 错误提示清晰明确

## 7. 风险评估

### 7.1 技术风险
- **数据源依赖**: akshare API稳定性风险
- **网络延迟**: 数据获取可能受网络影响
- **计算复杂度**: 相似度分析算法计算量较大

### 7.2 业务风险
- **策略有效性**: 交易策略的有效性需要验证
- **参数敏感性**: 策略参数对结果影响较大
- **市场风险**: 实际交易存在市场风险

### 7.3 缓解措施
- 实现数据缓存机制，减少API调用频率
- 提供参数调优建议和默认值(默认值不要写在代码里，需要在web页面可设置)


```
